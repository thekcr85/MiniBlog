@model IEnumerable<AuthorListItemViewModel>

@{
    ViewData["Title"] = "MiniBlog";
    var latestAuthors = ViewBag.LatestAuthors as List<AuthorListItemViewModel> ?? Model?.ToList() ?? new List<AuthorListItemViewModel>();
    var isSearching = !string.IsNullOrEmpty(ViewBag.SearchTerm);
    var searchTerm = ViewBag.SearchTerm as string ?? string.Empty; // Here we capture the search term from ViewBag which is set in the controller so that we can pass it to the _SearchCard partial view.
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h1 class="display-4">MiniBlog</h1>
            <p class="lead">Simple blogging platform built with ASP.NET Core.</p>
            <hr />

            @if (isSearching)
            {
                <h2>Search Results for "@ViewBag.SearchTerm"</h2>
                @if (Model == null || !Model.Any())
                {
                    <div class="alert alert-info">No authors found matching your search.</div>
                }
                else
                {
                    @await Html.PartialAsync("_AuthorList", Model)
                }
            }
            else
            {
                <div class="mt-4">
                    <a class="btn btn-primary me-2" href="@Url.Action("Index", "Author")">View All Authors</a>
                    <a class="btn btn-outline-secondary" href="@Url.Action("WithPosts", "Author")">Authors with Posts</a>
                </div>
            }
        </div>

        <div class="col-md-4">
            @await Html.PartialAsync("_LatestAuthorsCard", latestAuthors)
            @await Html.PartialAsync("_SearchCard", searchTerm)
            @await Html.PartialAsync("_QuickActionsCard")
        </div>
    </div>
</div>
